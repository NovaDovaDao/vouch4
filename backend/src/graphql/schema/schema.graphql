scalar Json
scalar DateTime
scalar DateOnly

enum UserAtGymRole {
  MANAGER
  TRAINER
  ROUTE_SETTER
  FRONT_DESK_STAFF
  CLEANING_STAFF
}

enum AgreementType {
  WAIVER
  TERMS_OF_SERVICE
  PRIVACY_POLICY
}

enum AgreementStatus {
  PENDING_SIGNATURE
  SIGNED
  EXPIRED
  REVOKED
}

# --- INTERFACES ---
interface Person {
  id: ID!
  email: String!
  firstName: String!
  lastName: String!
  name: String
  isActive: Boolean!
  walletAddress: String
  phoneNumber: String
}

# --- UNIONS ---
union SearchResult = Staff | Member | ClassTemplate | ScheduledClass | Gym
union StaffOrMember = Staff | Member

# --- OBJECTS ---

type Tenancy {
  id: ID!
  name: String!
  legalName: String
  contactEmail: String!
}

type GymAddress {
  street1: String
  city: String
  state: String
  zip: String
  country: String
}

type Gym {
  id: ID!
  name: String!
  address: Json
  legalEntityName: String
  legalDocsUrl: String
}

type Staff implements Person {
  id: ID!
  email: String!
  firstName: String!
  lastName: String!
  name: String
  isActive: Boolean!
  walletAddress: String
  phoneNumber: String
  isSuperUser: Boolean!
  roles: [UserAtGymRole!]
}

type Member implements Person {
  id: ID!
  email: String!
  firstName: String!
  lastName: String!
  name: String
  isActive: Boolean!
  walletAddress: String
  phoneNumber: String
  entitlements: [Entitlement!]!
  checkins: [CheckIn!]
}

# --- NEW PRODUCT & ENTITLEMENT SYSTEM ---

type Price {
  amount: String
  currency: String
}

type Product {
  id: ID!
  name: String!
  description: String
  price: Price
  active: Boolean!
  rules: Json!
  isNft: Boolean!
  contractAddress: String
}

type Entitlement {
  id: ID!
  validFrom: DateOnly!
  expiresAt: DateOnly
  usesLeft: Int
  tokenId: String
  isRented: Boolean!
  owner: Member!
  renter: Member
  product: Product!
}

# --- END NEW SYSTEM ---

type UserTenancyAgreement {
  id: ID!
  type: AgreementType!
  status: AgreementStatus!
  documentVersion: String
  signedAt: DateTime
  expiresAt: DateTime
}

type Booking {
  id: String!
  bookedAt: DateTime!
  member: Member!
}

type ClassTemplate {
  id: ID!
  name: String!
  description: String
  capacity: Int!
  gym: Gym!
  instructor: Staff
  recurrence: String!
}

type ScheduledClass {
  id: ID!
  name: String!
  description: String
  startTime: DateTime!
  endTime: DateTime!
  bookings: [Booking!]!
  gym: Gym!
  instructor: Staff
}

type CheckIn {
  id: String!
  timestamp: DateTime!
  member: Member!
}

# --- INPUTS ---

input CreateProductInput {
  name: String!
  description: String
  active: Boolean
  rules: Json!
  isNft: Boolean
  contractAddress: String
}

input UpdateProductInput {
  name: String
  description: String
  active: Boolean
  rules: Json
  isNft: Boolean
  contractAddress: String
}

input CreateEntitlementInput {
  ownerId: ID!
  productId: ID!
  validFrom: DateOnly
  expiresAt: DateOnly
  usesLeft: Int
}

input TenancyCreateInput {
  name: String!
  legalName: String
  contactEmail: String!
}

input TenancyUpdateInput {
  name: String
  legalName: String
  contactEmail: String
}

input ClassTemplateCreateInput {
  name: String!
  description: String
  capacity: Int!
  gymId: ID!
  instructorId: ID
  recurrence: String!
}

input ClassTemplateUpdateInput {
  name: String
  description: String
  capacity: Int
  gymId: ID
  instructorId: ID
  recurrence: String
}

input ScheduledClassesArgs {
  classTemplateId: ID
  gymId: ID
  startDate: DateTime
  endDate: DateTime
}

input ScheduledClassCreateInput {
  classTemplateId: ID!
  startTime: DateTime!
  endTime: DateTime!
}

input ScheduledClassUpdateInput {
  classTemplateId: ID
  startTime: DateTime
  endTime: DateTime
}

input GymAddressInput {
  street1: String
  city: String
  state: String
  zip: String
  country: String
}

input GymCreateInput {
  name: String!
  address: GymAddressInput!
  legalEntityName: String
  legalDocsUrl: String
}

input GymUpdateInput {
  name: String
  address: GymAddressInput
  legalEntityName: String
  legalDocsUrl: String
}

input MemberCreateInput {
  email: String!
  firstName: String!
  lastName: String!
  isActive: Boolean
  walletAddress: String
  phoneNumber: String
}

input MemberUpdateInput {
  email: String
  firstName: String
  lastName: String
  isActive: Boolean
  walletAddress: String
  phoneNumber: String
}

input StaffCreateInput {
  email: String!
  firstName: String!
  lastName: String!
  isSuperUser: Boolean
  isActive: Boolean
  walletAddress: String
  phoneNumber: String
}

input StaffUpdateInput {
  email: String
  firstName: String
  lastName: String
  isSuperUser: Boolean
  isActive: Boolean
  walletAddress: String
  phoneNumber: String
}

input BookingsArgs {
  gymId: ID
}

input SearchInput {
  query: String!
  limit: Int
}

# --- QUERIES ---
type Query {
  search(input: SearchInput!): [SearchResult!]!
  staff: [Staff!]!
  staffById(id: ID!): Staff!

  classTemplates: [ClassTemplate!]!
  classTemplateById(id: ID!): ClassTemplate!
  scheduledClasses(args: ScheduledClassesArgs!): [ScheduledClass!]!
  scheduledClassById(id: ID!): ScheduledClass!

  tenancy: Tenancy!

  contracts: [UserTenancyAgreement!]!
  contractById(id: ID!): UserTenancyAgreement!

  members: [Member!]!
  memberById(id: ID!): Member!

  products: [Product!]!
  productById(id: ID!): Product
  entitlements(memberId: ID!): [Entitlement!]!
  entitlementById(id: ID!): Entitlement

  gyms: [Gym!]!
  gymById(id: ID!): Gym

  bookings(input: BookingsArgs): [Booking!]!
}

# --- MUTATIONS ---
type Mutation {
  createTenancy(data: TenancyCreateInput!): Tenancy!
  updateTenancy(id: ID!, input: TenancyUpdateInput!): Tenancy!

  createProduct(input: CreateProductInput!): Product!
  updateProduct(id: ID!, input: UpdateProductInput!): Product!
  createEntitlement(input: CreateEntitlementInput!): Entitlement!

  createGym(data: GymCreateInput!): Gym!
  updateGym(id: ID!, data: GymUpdateInput!): Gym!
  deleteGym(id: ID!): Boolean!

  createClassTemplate(data: ClassTemplateCreateInput!): ClassTemplate!
  updateClassTemplate(id: ID!, input: ClassTemplateUpdateInput!): ClassTemplate!
  deleteClassTemplate(id: ID!): Boolean!
  createScheduledClass(input: ScheduledClassCreateInput!): ScheduledClass!
  updateScheduledClass(
    id: ID!
    input: ScheduledClassUpdateInput!
  ): ScheduledClass!
  deleteScheduledClass(id: ID!): Boolean!

  createStaff(data: StaffCreateInput!): Staff!
  updateStaff(id: ID!, input: StaffUpdateInput!): Staff!
  deleteStaff(id: ID!): Boolean!

  createMember(data: MemberCreateInput!): Member!
  updateMember(id: ID!, input: MemberUpdateInput!): Member!
  deleteMember(id: ID!): Boolean!
  setInitialPassword(token: String!, password: String!): StaffOrMember!

  ### MEMBERS ###
  memberAccessToken: String!
}
